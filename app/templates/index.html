<!doctype html>
<html lang="vi">

<head>
    <meta charset="utf-8" />
    <title>Dự báo thời tiết</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/static/style.css" />
    <!-- <link rel="stylesheet" href="/static/weather.css" /> -->
    <link rel="stylesheet" href="/static/style_new.css" />
</head>

<body>
    <main class="container">
        <h1>Dự báo thời tiết</h1>

        <form action="/search" method="get" class="search">
            <input type="text" name="city" placeholder="Nhập thành phố (vd: Hanoi)" required />
            <button type="submit">Xem</button>
        </form>

        {% if error %}
        <div class="error">{{ error }}</div>
        {% endif %}

        {% if result %}
        <section class="summary">
            <h2>{{ result.city }}, {{ result.country }}</h2>
            <p><strong>Ngày:</strong> {{ result.summary.date }}</p>
            <p><strong>Nhiệt độ:</strong> {{ '%.1f'|format(result.summary.temp_min) }} – {{
                '%.1f'|format(result.summary.temp_max) }} °C</p>
            <p><strong>Tình trạng:</strong> {{ result.summary.description }}</p>
            <p><strong>Khả năng mưa cao nhất:</strong> {{ '%.0f'|format(result.summary.pop_max * 100) }}%</p>
        </section>

        <section class="hourly">
            <h3>Chi tiết theo 3 giờ</h3>
            <div class="grid">
                {% for s in result.hourly %}
                <div class="card">
                    <p class="time"><strong>{{ s["time"] }}</strong></p>
                    <p>Nhiệt độ: {{ '%.1f'|format(s["temp"]) }} °C</p>
                    <p>Tình trạng: {{ s["description"] }}</p>
                    <p>Khả năng mưa: {{ '%.0f'|format((s["pop"] or 0) * 100) }}%</p>
                </div>
                {% endfor %}
            </div>

            <!-- Chart.js -->
            <canvas id="tempChart" data-labels='{{ result.hourly | map(attribute="time") | list | tojson }}'
                data-temps='{{ result.hourly | map(attribute="temp") | list | tojson }}'>
            </canvas>
            <!-- <script src="/static/weather.js"></script> -->
            <script src="/static/weather_new.js"></script>
        </section>
        {% else %}
        <p>Hãy nhập tên thành phố để xem dự báo.</p>
        {% endif %}
    </main>
</body>

</html>